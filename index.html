<!doctype html>
<html>
<head>
    <link href="js/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
    
<style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="js/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<script src="js/pagedown/Markdown.Converter.js"></script>
</head>
<body>
<div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">simbl</a>
          <div class="nav-collapse collapse">
            <ul class="nav" id="page-menu">
            
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">
      <div id="content">

	  </div>
    </div> <!-- /container -->

<script src="js/jquery-1.8.3.js"></script>
<script src="js/bootstrap/js/bootstrap.min.js"></script>
<script src="js/pagedown/Markdown.Converter.js"></script>
<script>
(function(){
    "use strict";
	var config = [];
	var converter = new Markdown.Converter();

    // get page list, build menu
    var getPages = function(){
    	$.ajax({
			url : "app.php/pages",
			type : "get",
			success : function (responseData) {
				renderPages(responseData['files']);
			},
			error: function(jqXHR, textStatus, errorThrown){
				$('#content').replaceWith('<div id="content" style="padding-top:60px;">' + jqXHR.responseText + '</div>');
			}
		});
	}();
	
	// get first n posts
	var loadPosts = function(number){
		$.ajax({
			url : "app.php/posts/"+number,
			type : "get",
			success : function (responseData) {
				renderPosts(responseData);
			},
			error: function(jqXHR, textStatus, errorThrown){
				$('#content').replaceWith('<div id="content" style="padding-top:60px;">' + jqXHR.responseText + '</div>');
			}
		});
	};
	
	loadPosts(10);
	
	// render page menu
	var renderPages = function(pageList){
		var link = link = $('<li><a href="#">Home</a></li>');

		$(link).click(function(){
			var func = loadPosts;
			
			return function(){
				func(10);
			};
		}());
		$('#page-menu').append(link)
		
		$.each(pageList, function(index, element){
			link = $('<li><a href="#">' + element.replace(/\.[^/.]+$/, "") + '</a></li>');
			$(link).click( {'page':element},function(event){
				$.ajax({
					url : "app.php/page/" + event.data.page,
					type : "get",
					success : function (responseData) {
						$('#content').replaceWith('<div id="content">' + converter.makeHtml(responseData.content) + '</div>');
					},
					error: function(jqXHR, textStatus, errorThrown){
						$('#content').replaceWith('<div id="content" style="padding-top:60px;">' + jqXHR.responseText + '</div>');
					}
				});
			});
			$('#page-menu').append(link);
		});
	};
    
   window.l=loadPosts;
	
	var renderPosts = function(postData){
		$('#content').replaceWith('<div id="content"></div>');
		$.each(postData, function(index, post){
			$('#content').append('<div class="post well">'+converter.makeHtml(post)+"</div>");
		});
	}
})();
</script>
</body>
</html>

